# Google OAuth 2.0 クライアントIDの作成手順

## ステップ1: Google Cloud Consoleでプロジェクトを選択

1. [Google Cloud Console](https://console.cloud.google.com/)にアクセス
2. 上部のプロジェクト選択ドロップダウンからプロジェクトを選択（または新規作成）

## ステップ2: Google Calendar APIを有効化

1. 左側のメニューから「APIとサービス」→「ライブラリ」を選択
2. 検索バーに「Google Calendar API」と入力
3. 「Google Calendar API」を選択
4. 「有効にする」ボタンをクリック

## ステップ3: OAuth同意画面を設定（初回のみ）

1. 左側のメニューから「APIとサービス」→「OAuth同意画面」を選択
2. ユーザータイプを選択：
   - **外部**（推奨：テスト用）
   - または「内部」（Google Workspaceのみ）
3. 「作成」をクリック
4. アプリ情報を入力：
   - **アプリ名**: 事務所管理アプリ（または任意の名前）
   - **ユーザーサポートメール**: あなたのメールアドレス
   - **アプリのロゴ**: （オプション）
   - **アプリのホームページ**: （オプション）
   - **アプリのプライバシーポリシーリンク**: （オプション）
   - **アプリの利用規約リンク**: （オプション）
   - **承認済みのドメイン**: （オプション）
5. 「保存して次へ」をクリック
6. スコープの追加：
   - 「スコープを追加または削除」をクリック
   - 以下のスコープを追加：
     - `https://www.googleapis.com/auth/calendar`
     - `https://www.googleapis.com/auth/calendar.events`
   - 「更新」→「保存して次へ」をクリック
7. テストユーザー（外部の場合）：
   - 「ユーザーを追加」をクリック
   - あなたのGoogleアカウントのメールアドレスを追加
   - 「保存して次へ」をクリック
8. 「ダッシュボードに戻る」をクリック

## ステップ4: OAuth 2.0 クライアントIDを作成

1. 左側のメニューから「APIとサービス」→「認証情報」を選択
2. 上部の「+ 認証情報を作成」をクリック
3. 「OAuth クライアント ID」を選択
4. アプリケーションの種類を選択：
   - **ウェブアプリケーション**
5. 名前を入力：
   - **名前**: 事務所管理アプリ（または任意の名前）
6. 承認済みのリダイレクト URIを追加：
   - 「URIを追加」をクリック
   - 以下のURIを追加：
     ```
     http://localhost:3000/api/auth/google
     http://localhost:3001/api/auth/google
     ```
   - 注意：両方のポートを追加してください（ポート3000と3001の両方に対応）
7. 「作成」をクリック

## ステップ5: クライアントIDとシークレットをコピー

1. モーダルウィンドウが表示されます
2. **クライアント ID**をコピー
3. **クライアント シークレット**をコピー
4. 「OK」をクリック

## ステップ6: 環境変数に設定

プロジェクトの`.env.local`ファイルを開き、以下のように設定：

```env
GOOGLE_CLIENT_ID=コピーしたクライアントID
GOOGLE_CLIENT_SECRET=コピーしたクライアントシークレット
GOOGLE_REDIRECT_URI=http://localhost:3000/api/auth/google
```

**重要**: 
- `コピーしたクライアントID`と`コピーしたクライアントシークレット`を実際の値に置き換えてください
- クライアントIDは通常、`.apps.googleusercontent.com`で終わります

## ステップ7: 開発サーバーを再起動

環境変数を変更した場合は、開発サーバーを再起動してください：

```bash
# 現在のサーバーを停止（Ctrl+C）
npm run dev
```

## トラブルシューティング

### エラー400: リクエストが正しくない
- Google Cloud Consoleの「承認済みのリダイレクト URI」が正しく設定されているか確認
- ポート番号（3000または3001）が一致しているか確認
- 環境変数に実際の値が設定されているか確認

### エラー: リダイレクトURI不一致
- Google Cloud Consoleで、使用しているポート番号に対応するリダイレクトURIが追加されているか確認
- 両方のポート（3000と3001）を追加することを推奨

### エラー: スコープが承認されていない
- OAuth同意画面でスコープが正しく追加されているか確認
- テストユーザーとして自分のメールアドレスが追加されているか確認（外部アプリの場合）

